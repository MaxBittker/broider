function e(e,t,n,o){Object.defineProperty(e,t,{get:n,set:o,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},o={},r={},a=n.parcelRequireed3d;null==a&&((a=function(e){if(e in o)return o[e].exports;if(e in r){var t=r[e];delete r[e];var n={id:e,exports:{}};return o[e]=n,t.call(n.exports,n,n.exports),n.exports}var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){r[e]=t},n.parcelRequireed3d=a),a.register("27Lyk",(function(t,n){var o,r;e(t.exports,"register",(()=>o),(e=>o=e)),e(t.exports,"resolve",(()=>r),(e=>r=e));var a={};o=function(e){for(var t=Object.keys(e),n=0;n<t.length;n++)a[t[n]]=e[t[n]]},r=function(e){var t=a[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),a("27Lyk").register(JSON.parse('{"6evGa":"index.eca9f7b2.js","55edQ":"1.4174c112.png","99rIB":"2.672c92e3.png","aLMx8":"4.1e9ab26e.png"}'));var i;i=new URL(a("27Lyk").resolve("55edQ"),import.meta.url).toString();var l;l=new URL(a("27Lyk").resolve("99rIB"),import.meta.url).toString();var d;d=new URL(a("27Lyk").resolve("aLMx8"),import.meta.url).toString();var c,s;s=function(){var e=document.getSelection();if(!e.rangeCount)return function(){};for(var t=document.activeElement,n=[],o=0;o<e.rangeCount;o++)n.push(e.getRangeAt(o));switch(t.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":t.blur();break;default:t=null}return e.removeAllRanges(),function(){"Caret"===e.type&&e.removeAllRanges(),e.rangeCount||n.forEach((function(t){e.addRange(t)})),t&&t.focus()}};var u={"text/plain":"Text","text/html":"Url",default:"Text"};c=function(e,t){var n,o,r,a,i,l,d=!1;t||(t={}),n=t.debug||!1;try{if(r=s(),a=document.createRange(),i=document.getSelection(),(l=document.createElement("span")).textContent=e,l.style.all="unset",l.style.position="fixed",l.style.top=0,l.style.clip="rect(0, 0, 0, 0)",l.style.whiteSpace="pre",l.style.webkitUserSelect="text",l.style.MozUserSelect="text",l.style.msUserSelect="text",l.style.userSelect="text",l.addEventListener("copy",(function(o){if(o.stopPropagation(),t.format)if(o.preventDefault(),void 0===o.clipboardData){n&&console.warn("unable to use e.clipboardData"),n&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var r=u[t.format]||u.default;window.clipboardData.setData(r,e)}else o.clipboardData.clearData(),o.clipboardData.setData(t.format,e);t.onCopy&&(o.preventDefault(),t.onCopy(o.clipboardData))})),document.body.appendChild(l),a.selectNodeContents(l),i.addRange(a),!document.execCommand("copy"))throw new Error("copy command was unsuccessful");d=!0}catch(r){n&&console.error("unable to copy using execCommand: ",r),n&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(t.format||"text",e),t.onCopy&&t.onCopy(window.clipboardData),d=!0}catch(r){n&&console.error("unable to copy using clipboardData: ",r),n&&console.error("falling back to prompt"),o=function(e){var t=(/mac os x/i.test(navigator.userAgent)?"âŒ˜":"Ctrl")+"+C";return e.replace(/#{\s*key\s*}/g,t)}("message"in t?t.message:"Copy to clipboard: #{key}, Enter"),window.prompt(o,e)}}finally{i&&("function"==typeof i.removeRange?i.removeRange(a):i.removeAllRanges()),l&&document.body.removeChild(l),r()}return d};var f=16;function g(){return new Array(3).fill(0).map(((e,t)=>new Array(3).fill(0).map(((e,t)=>new Array(7).fill(0).map(((e,t)=>new Array(7).fill(0)))))))}function m([e,t],n=1){return[[e,t],[20-t,e],[20-e,20-t],[t,20-e]]}function p(e,t){let n=t.reduce(((e,t)=>e[t]),e);return"number"!=typeof n?0:n}function h(e,t,n=1){let o=t.slice(0,-1),r=t[t.length-1];o.reduce(((e,t)=>e[t]),e)[r]=n}let y=document.getElementById("target"),w=document.getElementById("editor"),v=document.getElementById("guide"),b=document.getElementById("render");var E=w.getContext("2d"),x=v.getContext("2d"),L=b.getContext("2d");function C(){E.clearRect(0,0,w.width,w.height)}function R(e,t){L.fill();for(let n=0;n<3;n++)for(let o=0;o<3;o++)for(let r=0;r<7;r++)for(let a=0;a<7;a++){let i=p(e,[n,o,r,a]);E.fillStyle=1==i?window.paintColor:"#fff0",L.fillStyle=1==i?window.paintColor:"#fff0";let l=(7*n+r)*t,d=(7*o+a)*t;1==n&&1==o||(L.clearRect(l,d,t,t),L.fillRect(l,d,t,t),l*=f/t,d*=f/t,E.fillRect(l+1,d+1,15,15))}}function S(e){let t=b.toDataURL(),n=document.getElementById("border-style");n&&n.remove(),n=document.createElement("style"),n.id="border-style",document.head.appendChild(n);let o=7*e,r=`.broider {\n    border-image:  url("${t}") ${o} /  ${o}px / 0 round;\n    border-width:  ${o}px;\n    border-style:  solid;\n}`;n.sheet.insertRule(r),y.textContent=r}function k(e,t){let n=7*t[0]+t[2],o=7*t[1]+t[3];E.fillStyle=(p(e,t),"#dde"),1==t[0]&&1==t[1]||E.fillRect(n*f+0,o*f+0,16,16)}function I(){y.setAttribute("data-after","[Click to copy]")}function T(e,t,n,o){if(!e)return"";const r=7*n,a=`border-image:  url('${encodeURI(e)}') ${r} /  ${r}px / 0 round;\n    border-width:  ${r}px;\n    border-style:  solid; `,i=`.${D(t)} {\n    ${a}\n  }`;return`\n  <pre class="gallery-line" data-after="[Click to copy]" style="${D(a)}" data-index="${o}">\n    ${D(i)}\n  </pre>\n    `}function D(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}L.imageSmoothingEnabled=!1,y.addEventListener("click",(function(){t(c)(y.textContent,{message:"Press #{key} to copy css"}),y.setAttribute("data-after","Copied to your clipboard!"),y.classList.remove("flash"),window.setTimeout((()=>{y.classList.add("flash")}),1),window.setTimeout(I,2500)})),I();let B=document.getElementById("title"),A=document.getElementById("submit"),U=document.getElementById("gallery"),$=document.getElementById("render"),M=[];function _(){let e=M.map(((e,t)=>T(e.dataUrl,e.title,e.pixelRatio,t)));U.innerHTML=e.join(""),document.querySelectorAll(".gallery-line").forEach((e=>{e.addEventListener("click",(n=>{const o=n.target,r=parseInt(o.dataset.index);ie(M[r]),t(c)(e.textContent),e.setAttribute("data-after","Copied to your clipboard!"),e.classList.remove("flash"),window.setTimeout((()=>{e.classList.add("flash")}),1),window.setTimeout((()=>{e.setAttribute("data-after","[Click to copy]")}),2500)}))}))}!async function(){let e=await fetch("https://maxbittker-broider.web.val.run/").then((e=>e.json()));M=e.submissions,console.log("submissions",M),_()}(),A.addEventListener("click",(()=>{let e=$.toDataURL(),t=parseInt($.dataset.pixelRatio);var n;M.push({title:(n=B.value,(n=(n=(n=n.toLowerCase()).replace(/ /g,"-")).replace(/[^a-z0-9-_]/g,""))&&!/^[a-z_]/.test(n)&&(n="_"+n),n),dataUrl:e,pixelRatio:t,who:""}),async function(e){let t=await fetch("https://maxbittker-broider.web.val.run/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json()));M=t.submissions,_()}(M[M.length-1]),_()}));let O=document.getElementById("pen"),P=document.getElementById("eraser"),N=document.getElementById("symmetry"),H=document.getElementById("undo"),j=document.getElementById("scale"),X=document.getElementById("color"),F=document.getElementById("editor-frame"),J=document.getElementById("editor"),Y=document.getElementById("guide"),q=document.getElementById("render");J.width=336,J.height=336,Y.width=336,Y.height=336;let z=2,Q=[1,2,4],G=[t(i),t(l),t(d)],W=Q[z];function K(){F.style.height=J.getBoundingClientRect().width+"px"}q.width=7*W*3,q.height=7*W*3,q.dataset.pixelRatio=W.toString(),j.addEventListener("click",(()=>{z=(z+1)%Q.length,j.src=G[z],W=Q[z],q.width=7*W*3,q.height=7*W*3,q.dataset.pixelRatio=W.toString(),R(te,W),S(W),K()})),window.paintColor="#000",X.addEventListener("input",(e=>{window.paintColor=e.target.value,R(te,W),S(W)})),document.addEventListener("DOMContentLoaded",K),window.addEventListener("resize",K);var V=!1,Z=!1,ee=!0;N.addEventListener("click",(e=>{ee=!ee,N.classList.toggle("selected")})),P.addEventListener("click",(e=>{Z=!0,P.classList.add("selected"),O.classList.remove("selected")})),O.addEventListener("click",(e=>{Z=!1,O.classList.add("selected"),P.classList.remove("selected")}));var te=g();let ne=[JSON.stringify(te)];function oe(){let e=JSON.stringify(te);e!=ne[ne.length-1]&&(ne.push(e),ne.length>50&&ne.shift(),H.classList.add("selected"))}H.addEventListener("click",(e=>{!function(){ne.pop();let e=ne[ne.length-1];e&&(te=JSON.parse(e),C(),R(te,W),S(W))}(),ne.length<2&&H.classList.remove("selected"),e.preventDefault()})),function(){for(let e=1;e<3;e++){x.strokeStyle="#33f",x.lineWidth=.5;let t=e*w.width/3;x.beginPath(),x.moveTo(t,0),x.lineTo(t,w.height),x.stroke(),x.beginPath(),x.moveTo(0,t),x.lineTo(w.height,t),x.stroke()}for(let e=0;e<21;e++){x.strokeStyle="#ccc";let t=e*w.width/21;x.beginPath(),x.moveTo(t,0),x.lineTo(t,w.height),x.stroke(),x.beginPath(),x.moveTo(0,t),x.lineTo(w.height,t),x.stroke()}let e=w.width/3;x.clearRect(e+1,e+1,e-2,e-2),x.beginPath(),x.moveTo(1*e,2*e),x.lineTo(2*e,1*e),x.stroke(),x.beginPath(),x.moveTo(1*e,1*e),x.lineTo(2*e,2*e),x.stroke()}(),R(te,W),S(W);let re=(e,t=!1,n=!1)=>{let{left:o,top:r,width:a,height:i}=J.getBoundingClientRect(),l=e.clientX-o,d=e.clientY-r,c=l/a*J.width,s=d/i*J.height,u=Math.floor(c/f),g=Math.floor(s/f),y=ee?m([u,g]):[[u,g]];C(),y.forEach((([e,o])=>{let r=Math.floor(e/7),a=Math.floor(o/7),i=[r,a,e%7,o%7];if(r<0||r>2||a<0||a>2)return;n&&k(te,i);let l=p(te,i);t||(l=0),Z&&(l=1),function(e,t){V&&h(te,e,1-t)}(i,l)})),R(te,W),window.setTimeout((()=>S(W)),0)};J.addEventListener("mousedown",(e=>{V=!0,re(e,!0)})),J.addEventListener("mousemove",(e=>{re(e,!1,!0)})),J.addEventListener("mouseout",(e=>{C(),R(te,W)})),window.addEventListener("mousedown",(()=>{V=!0})),window.addEventListener("mouseup",(()=>{V=!1,oe()})),J.addEventListener("touchend",(e=>{V=!1,oe()})),J.addEventListener("touchstart",(e=>{V=!0,e.preventDefault();const t=e.targetTouches;for(let n=0;n<t.length;n++)e.clientX=t[n].clientX,e.clientY=t[n].clientY,re(e)})),J.addEventListener("touchmove",(e=>{e.preventDefault(),V=!0;const t=e.targetTouches;for(let n=0;n<t.length;n++)e.clientX=t[n].clientX,e.clientY=t[n].clientY,re(e)}));let ae=0;function ie(e){z=Q.indexOf(e.pixelRatio),-1===z&&(z=0),j.src=G[z],W=Q[z],q.width=7*W*3,q.height=7*W*3,q.dataset.pixelRatio=W.toString();const t=new Image;t.onload=()=>{const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0);const o=n.getImageData(0,0,t.width,t.height);te=g();let r=null;for(let e=0;e<t.height;e++)for(let n=0;n<t.width;n++){const a=4*(e*t.width+n),i=o.data[a],l=o.data[a+1],d=o.data[a+2];if(o.data[a+3]>0){const t=Math.floor(n/(7*W)),o=Math.floor(e/(7*W)),a=Math.floor(n%(7*W)/W),c=Math.floor(e%(7*W)/W);h(te,[t,o,a,c],1),r||(r=`#${i.toString(16).padStart(2,"0")}${l.toString(16).padStart(2,"0")}${d.toString(16).padStart(2,"0")}`)}}r&&(window.paintColor=r,X.value=r),C(),R(te,W),S(W),oe()},t.src=e.dataUrl}window.addEventListener("touchend",(e=>{e.timeStamp-ae<=500&&(e.preventDefault(),e.target.click()),V=!1,ae=e.timeStamp})),_();
//# sourceMappingURL=index.eca9f7b2.js.map
